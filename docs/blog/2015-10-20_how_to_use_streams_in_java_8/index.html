<!DOCTYPE html>
<html><head><title>Software Bears</title><link href="//fonts.googleapis.com/css?family=Montserrat+Alternates:400,700" rel="stylesheet" type="text/css"><link href="/css/normalize.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css" rel="stylesheet" type="text/css"><link href="/css/highlight.min.css" rel="stylesheet" type="text/css"><script src="/js/main.js" type="text/javascript"></script><script src="/js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
hljs.configure({languages: []}); hljs.initHighlightingOnLoad();
//]]></script><link href="/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57"><link href="/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60"><link href="/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72"><link href="/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76"><link href="/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114"><link href="/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest"><meta content="#000000" name="msapplication-TileColor"><meta content="#ffffff" name="theme-color"></head><body><header><h1 class="name"><span>Software</span><span>Bears</span></h1></header><nav><div id="show-nav"></div><ul><li><a href="/">Home</a></li><li><a href="/portfolio">Portfolio</a></li><li><a href="/blog">Blog</a></li><li><a href="/contact">Contact us</a></li></ul></nav><div class="intro full black"><p class="middle"><span class="name"><span>Software</span><span>Bears</span>.com</span></p></div><main class="blog"><section class="white" id="blog-item"><h2>Real-world tips for streams in Java 8</h2><p><img src="/img/tuolumne&#95;river&#95;at&#95;tuolumne&#95;meadows.jpg" alt="Pre-Java-8 stream" title="Streams existed before Java 8 as well" /></p><p>We made the switch from Java 7 to Java 8 a few months ago, not long after the last public release of JDK 7. This is at my 9-to-5 job. It was practically a seamless transition. Since then, I've enjoyed using one of Java 8's new features: streams! Streams add a functional element to Java that is useful for processing collections of elements.</p><p>When I created my first streams, I wasn't aware of the full capabilities offered by this new feature. So, I'd like to share some tips from my real-world use of streams. While I've modified the objects to be more generic, these examples are very similar to streams I created for real services.</p><h3>The method reference operator</h3><p>Along with streams, one of the new features in Java 8 is the <strong>method reference operator</strong>. I think of it as the "double colon" operator usually, because it's two colons in a row. This operator allows you to refer to a class method to produce a function interface type, such as a <a href='https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html'>Predicate</a> or <a href='https://docs.oracle.com/javase/8/docs/api/java/util/function/Consumer.html'>Consumer</a>. For example, you might use <code>Point::toString</code> to use an object's <code>toString</code> method in the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#map-java.util.function.Function-'>map</a> function.</p><p>Oracle has a <a href='https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.13'>good list of example uses</a> of the method reference operator.</p><p>I've found the method reference operator to be useful when creating new objects.</p><pre><code class="java">Set&lt;String&gt; names = people.stream&#40;&#41;
    .map&#40;Person::getFirstName&#41;
    .collect&#40;toCollection&#40;HashSet::new&#41;&#41;;
</code></pre><p>I didn't realize at first that the operator could be used to create new arrays as well.</p><pre><code class="java">String&#91;&#93; urls = images.stream&#40;&#41;.map&#40;i -&gt; i.url&#41;
    .filter&#40;Objects::nonNull&#41;
    .toArray&#40;String&#91;&#93;::new&#41;;
</code></pre><p>Finally, the operator is useful to get an iterator from the stream.</p><pre><code class="java">urlsToLoad.addAll&#40;Arrays.stream&#40;urls&#41;
    .map&#40;String::trim&#41;::iterator&#41;;
</code></pre><h3>Flat streams</h3><p>Say you have a list of HTML elements, and each element has a list of CSS classes. You can use the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#flatMap-java.util.function.Function-'>flatMap</a> function to get a list of all the class names. Its argument must be a function that returns a stream.</p><pre><code class="java">elements.stream&#40;&#41;.filter&#40;e -&gt; e.tag.equals&#40;&quot;p&quot;&#41;&#41;
    .flapMap&#40;e -&gt; e.cssClassNames.stream&#40;&#41;&#41;
    .collect&#40;ArrayList::new&#41;;
</code></pre><p>There are also special functions for primitives, such as <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#flatMapToInt-java.util.function.Function-'>flatMapToInt</a>, which accepts a function that returns an <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html'>IntStream</a>. If you have a list of items, each of which has a list of numeric categories, you could obtain a single array of the categories like this:</p><pre><code class="java">int&#91;&#93; categories = items.stream&#40;&#41;
    .filter&#40;b -&gt; b.categories != null&#41;
    .flatMapToInt&#40;b -&gt; IntStream.of&#40;b.categories&#41;&#41;
    .toArray&#40;&#41;;
</code></pre><h3>Streaming maps</h3><p>With streams, you can operate on maps in addition to arrays and collections. To do so, you can get a stream on the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#entrySet--'>entrySet</a>. (Of course, you can use the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#keySet--'>keys</a> or <a href='https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#values--'>values</a>, but then you get only ... keys and values.) Then, you can use <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html#toMap-java.util.function.Function-java.util.function.Function-'>toMap</a> to convert the stream back to a map.</p><pre><code class="java">cookies.entrySet&#40;&#41;.stream&#40;&#41;
    .filter&#40;c -&gt; c.getValue&#40;&#41;.equals&#40;&quot;1&quot;&#41;&#41;
    .collect&#40;Collectors.toMap&#40;Entry::getKey, Entry::getValue&#41;&#41;;
</code></pre><p>You can also create a stream from a collection, and convert the stream to a map. Again, Oracle has some <a href='https://docs.oracle.com/javase/tutorial/collections/streams/reduction.html#collect'>examples</a> of how this can be done.</p><h3>Do not return streams from public methods</h3><p>It's tempting, but I would advise against returning streams from methods, especially public methods. A stream can be used only once. A stream returned by a public method is bound to cause a bug at some point. A more flexible option is to return a collection. Then, the caller of the method can create a stream from the collection if they so choose.</p><p>For example, instead of this signature:</p><pre><code class="java">public Stream&lt;String&gt; findFirstNames&#40;&#41;
</code></pre><p>I would recommend this one:</p><pre><code class="java">public Set&lt;String&gt; findFirstNames&#40;&#41;
</code></pre><p>If it's a private method, then it might be okay to return a stream, because you can control its usage.</p><h3>Concatenate streams</h3><p>Multiple streams can be concatenated into a single stream with the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#concat-java.util.stream.Stream-java.util.stream.Stream-'>concat</a> function.</p><p>You might have a private function that accepts two streams as an argument. It could combine both streams using <code>concat</code>, then filter them together.</p><pre><code class="java">private static List&lt;Point&gt; combine&#40;Stream&lt;Point&gt; a, Stream&lt;Point&gt; b&#41; {
    return Stream.concat&#40;a, b&#41;
        .filter&#40;p -&gt; p.x &gt;= 0&#41;
        .collect&#40;Collectors.toList&#40;&#41;&#41;;
}
</code></pre><p>Calls to the function might look like the example below. You can create streams with the <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#empty--'>empty</a> and <a href='https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#of-T...-'>of</a> functions.</p><pre><code class="java">// call with empty stream
List&lt;Point&gt; points1 = combine&#40;PointFactory.randomPoints&#40;10&#41;.stream&#40;&#41;, Stream.empty&#40;&#41;&#41;;

// inject additional points from another source
List&lt;Point&gt; points2 = combine&#40;points1, Stream.of&#40;new Point&#40;1, 1&#41;, new Point&#40;-1, -1&#41;&#41;&#41;;
</code></pre></section></main><footer class="black"><h2>Want to see more? View our <a href="/portfolio">portfolio</a>, read our <a href="/blog">blog</a>, or check out our GitHub <a href="https://github.com/cberes">repos</a>.</h2><p>Corey Beres<br>Freelance software engineer<br>SOA, web services, Android apps &amp; SDKs,<br>web applications, and database design</p><p>Email: <a href="mailto:hello@softwarebears.com">hello@softwarebears.com</a><br>Tel: (716) 222 0088<br>Find us on <a href="https://github.com/cberes">GitHub</a>, <a href="https://instagram.com/softwarebears">Instagram</a>, &amp <a href="https://twitter.com/softwarebears">Twitter</a><br>&copy; 2015-2017 <span class="name"><span>Software</span><span>Bears</span></span></p><div class="clear"></div></footer></body></html>