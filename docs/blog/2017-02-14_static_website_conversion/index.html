<!DOCTYPE html>
<html><head><title>SeaBears</title><link href="//fonts.googleapis.com/css?family=Montserrat+Alternates:400,700" rel="stylesheet" type="text/css"><link href="/css/normalize.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css" rel="stylesheet" type="text/css"><link href="/css/highlight.min.css" rel="stylesheet" type="text/css"><script src="/js/main.js" type="text/javascript"></script><script src="/js/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
hljs.configure({languages: []}); hljs.initHighlightingOnLoad();
//]]></script><link href="/rss.xml" rel="alternate" type="application/rss+xml"><link href="/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57"><link href="/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60"><link href="/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72"><link href="/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76"><link href="/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114"><link href="/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/manifest.json" rel="manifest"><meta content="#000000" name="msapplication-TileColor"><meta content="#ffffff" name="theme-color"></head><body><header><h1 class="name"><span>Sea</span><span>Bears</span></h1></header><nav><div id="show-nav"></div><ul><li><a href="/">Home</a></li><li><a href="/portfolio">Portfolio</a></li><li><a href="/blog">Blog</a></li><li><a href="/contact">Contact us</a></li></ul></nav><div class="intro full black"><p class="middle"><span class="name"><span>Sea</span><span>Bears</span>.net</span></p></div><main class="blog"><section class="white" id="blog-item"><h2>How I converted this website to a static website</h2><p class="metadata">By <span class="author">Corey Beres</span> on <span class="time">Tue, Feb 14, 2017</span></p><p><img src="/img/static.png" alt="Static" title="Do not adjust your TV set." /></p><p>Yesterday I converted this website (my personal portfolio) to a static website. The advantages seemed clear: cheap hosting, faster loading times, etc. But this website was built with <a href='https://github.com/ring-clojure/ring'>Ring</a> and <a href='https://github.com/weavejester/compojure'>Compojure</a>. I'll explain how I made the change in this post.</p><p>I made the changes in three commits. You can see them on GitHub: <a href='https://github.com/cberes/softwarebears/commit/50c81cf40e020a0dcf7339036881b592b62cb220'>here</a>, <a href='https://github.com/cberes/softwarebears/commit/beb8866753dfeb5bbfca8aea47e1485e67d04d84'>here</a>, and <a href='https://github.com/cberes/softwarebears/commit/a6c2271505852f2732b2ea3361e5572b2c6c2bc3'>here</a>.</p><h3>Replace dynamic features with external services</h3><p>The first change I made was to remove one dynamic feaure: the contact form.</p><p>The contact form sends an email to me with the contents of the form. At least that was the plan. Amazon limits your ability to send email from their EC2 service. You need to use their <a href='https://aws.amazon.com/ses'>SES</a> service to send email. I got this working for my website <a href='http://7itemsorless.com'>7itemsorless.com</a>, but I never got around to making the change on this website. So this form actually saved a file to the server.</p><p>Using <a href='https://formspree.io/'>Formspree</a> made this change really easy. All I did was change the form's <code>action</code>, and I removed the parts of the module that processed the form. Formspree does the rest. So that part was easy</p><h3>Render static pages</h3><p>Next, I wrote the code that saved each page's HTML to a file. Because of the way Compojure works, I already had functions written that created the HTML for each page. All that was left to do was to create a new <code>main</code> function that grabbed the HTML and saved it to a file.</p><p>I could have just saved the HTML to a file for each page (e.g. portfolio.html, contact.html, etc.). But I wanted to keep the same URLs from the dynamic website. Thus I created a folder with an index.html file inside for each page.</p><p>Now, a robust solution would have queried Compojure to get all available routes. Then HTML pages could be built for each of these routes. But I decided to make it easy on myself and hard-code the pages. Afterall, I don't envision my adding many pages to this website.</p><p>Here's the relevant code below.</p><pre><code class="clojure">&#40;ns softwarebears.generator
  &#40;:gen-class&#41;
  &#40;:require &#91;clojure.java.io :as io&#93;
            &#91;softwarebears.routes.home :refer &#91;home&#93;&#93;
            &#91;softwarebears.routes.portfolio :refer &#91;portfolio&#93;&#93;
            &#91;softwarebears.routes.blog :refer &#91;blog&#93;&#93;
            &#91;softwarebears.routes.contact :refer &#91;contact&#93;&#93;
            &#91;softwarebears.routes.error :refer &#91;not-found&#93;&#93;&#41;&#41;

&#40;defn save-page &#91;f &amp; paths&#93;
  &#40;let &#91;file &#40;apply io/file paths&#41;&#93;
    &#40;io/make-parents file&#41;
    &#40;spit file &#40;f&#41;&#41;&#41;&#41;

&#40;defn -main &#91;&amp; args&#93;
  &#40;let &#91;root &#40;first args&#41;&#93;
    &#40;save-page home root &quot;index.html&quot;&#41;
    &#40;save-page not-found root &quot;404.html&quot;&#41;
    &#40;save-page portfolio root &quot;portfolio&quot; &quot;index.html&quot;&#41;
    &#40;save-page contact root &quot;contact&quot; &quot;index.html&quot;&#41;
    &#40;save-page blog root &quot;blog&quot; &quot;index.html&quot;&#41;&#41;&#41;
</code></pre><p>One last thing. I had to edit project.clj and tell <code>lein</code> where to find the new <code>main</code> function.</p><h3>Render pages for each blog</h3><p>One more dynamic feature remained: the blog. I needed to get every blog entry's URL and save an HTML file in the right location. Luckily, I already had written code that gets the blog entries and renders their HTML!</p><p>All that I needed to do was re-arrange some code in the blog module and then call the new functions from the <code>main</code> function. I created a helper function for this. Here it is.</p><pre><code class="clojure">&#40;defn save-blog-entries &#91;root blog-root file-name&#93;
  &#40;doseq &#91;id &#40;get-blog-item-ids&#41;&#93;
    &#40;save-page &#40;render-blog-item id&#41; root blog-root id file-name&#41;&#41;&#41;
</code></pre><p>And I called it like so:</p><pre><code class="clojure">&#40;save-blog-entries root &quot;blog&quot; &quot;index.html&quot;&#41;
</code></pre><h3>Putting it all together</h3><p>I still needed to build the JAR, execute it, and copy some assets (JavaScript, CSS, and images). I use ClojureScript for this project. I was worried that it might be complicated to generate a JavaScript file from these sources. But that was a silly worry&mdash;the JavaScript was already being created every time I built the JAR.</p><p>I created a <code>bash</code> script that builds the JAR, executes the JAR, and copies assets. I think it would have been more prudent to create a Leiningen hook. However, I'm not fimiliar with Leiningen hooks. Instead I went with the quick and dirty solution (i.e. <code>bash</code>).</p><h3>Future work</h3><p>All of that was sufficient to replace my EC2-hosted website with a static website that I can host for free on <a href='https://pages.github.com/'>GitHub Pages</a>. Of course, there is still some work to do.</p><ol><li>Add pagination for the blog entries</li><li>Create an RSS file to index blog entries</li><li>Query Compojure to get routes to generate</li><li>Write a Leiningen hook to build the static website</li><li>Clean up the build process (ClojureScript can be compiled independently from the uberjar's creation)</li></ol></section></main><footer class="black"><h2>Want to see more? View our <a href="/portfolio">portfolio</a>, read our <a href="/blog">blog</a>, or check out our GitHub <a href="https://github.com/cberes">repos</a>.</h2><p>Corey Beres<br>Freelance software engineer<br>SOA, web services, Android apps &amp; SDKs,<br>web applications, and database design</p><p>Email: <a href="mailto:hello@seabears.net">hello@seabears.net</a><br>Tel: <img class="bottom" src="/img/dial-now-dark.png"><br>Find us on <a href="https://github.com/cberes">GitHub</a>, <a href="https://instagram.com/coreyberes">Instagram</a>, &amp <a href="https://twitter.com/SeaBearsNet">Twitter</a><br>&copy; 2015-2017 <span class="name"><span>Sea</span><span>Bears</span></span></p><div class="clear"></div></footer></body></html>